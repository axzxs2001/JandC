@page "/"
@using Microsoft.AspNetCore.Authorization;
@using Microsoft.AspNetCore.Authentication;
@using Microsoft.AspNetCore.Authentication.Cookies;
@using System.Security.Claims;
<h1>Hello, 文章</h1>

Welcome to your new 文章 app.
@functions{

    public async Task LoginAsync(string userName, string password, string returnUrl = null)
    {
        var list = new List<dynamic> {
                 new { UserName = "gsw", Password = "111111", Role = "admin",Name="桂素伟" },
                 new { UserName = "aaa", Password = "222222", Role = "system" ,Name="路人甲"}
             };
        var user = list.SingleOrDefault(s => s.UserName == userName && s.Password == password);
        if (user != null)
        {
            //用户标识
            var identity = new ClaimsIdentity(CookieAuthenticationDefaults.AuthenticationScheme);
            identity.AddClaim(new Claim(ClaimTypes.Sid, userName));
            identity.AddClaim(new Claim(ClaimTypes.Name, user.Name));
            identity.AddClaim(new Claim(ClaimTypes.Role, user.Role));
            
            await HttpContext.SignInAsync(CookieAuthenticationDefaults.AuthenticationScheme, new ClaimsPrincipal(identity));
        
        }
       
    }

}